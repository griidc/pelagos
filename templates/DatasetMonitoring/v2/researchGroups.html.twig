{% set divContainer = "gridContainer#{random()}" %}
<script>
    var data = [];

    {% for dataset in researchGroup.datasets %}
        data.push({
            'id': '{{ dataset.id }}',
            'title': '{{ dataset.title }}',
            'udi': '{{ dataset.udi }}',
            'doi': '{{ (dataset.doi) ? dataset.doi.doi : "" }}',
            'status': '{{ dataset.getDatasetLifecycleStatus.value }}',
            'researchGroup': '{{ dataset.researchGroup.name }}',
        });
    {% endfor %}

    $(() => {
    $('#{{divContainer}}').dxDataGrid({
        dataSource: data,
        columnAutoWidth: true,
        sortOrder: 'asc',
        searchPanel: {
            visible: false,
        },
        columns: [{
            dataField: 'udi',
            caption: 'UDI',
            width: '10rem',
        },{
            dataField: 'doi',
            caption: 'DOI',
            width: '12rem',
        },{
            dataField: 'title',
            caption: 'Title',
        },
        {
            dataField: 'status',
            caption: 'Status',
            width: 100,
        },
        {% if groupByResearchGroup|default(false) %}
        {
            dataField: 'researchGroup',
            sortOrder: 'asc',
            groupIndex: 0,
            groupCellTemplate: function(element, options) {
                // Make sure these arrays exist.
                element.html(options.value + "<br>Leadership: " + options.data.items[0].leaderShip + "<br>Datasets:" + options.summaryItems[0].value);
            }
        },{% endif %}
        ],
        showBorders: true,
        paging: {
            pageSize: 0,
        },
        pager: {
            visible: false,
        },
        selection: {
            mode: 'single',
        },
        groupPanel: {
            visible: false,
        },
        grouping: {
            autoExpandAll: true,
        },
        allowColumnReordering: false,
        rowAlternationEnabled: false,
        sortByGroupSummaryInfo: [{
            summaryItem: 'count',
        }],
        summary: {
            groupItems: [{
                column: 'udi',
                summaryType: 'count',
                displayFormat: '<br>{0} Datasets',
            }],
            totalItems: [{
                column: 'udi',
                summaryType: 'count',
                displayFormat: 'Total Datasets {0}',
            }],
        },
        showColumnLines: true,
        showRowLines: true,
        wordWrapEnabled: true,
    });
});
</script>

<div class="p-2 m-0">
    {% if not fundingCycle|default %}
    <div class="block">
        <span class="font-bold">Funding Source:</span> {{ researchGroup.fundingCycle.name }}
    </div>
    {% else %}
    <div class="block">
        <span class="font-bold">Research Group:</span> {{ researchGroup.name }}
    </div>
    {% endif %}
    <div class="block">
        <span class="font-bold">Leadership:</span>
        {% set leadership = researchGroup.personResearchGroups | role(constant('App\\Entity\\ResearchGroupRole::LEADERSHIP')) %}
        {% for prg in leadership | sortBy(['person.lastName', 'person.firstName']) %}
            {{ prg.person.firstName }} {{ prg.person.lastName }}
            {% if not loop.last %}, {% endif %}
        {% endfor %}
    </div>
    <div class="block">
        <span class="font-bold">Datasets:</span> {{ researchGroup.datasets|length }}
    </div>
    <div id="{{divContainer}}"></div>
</div>
<div class="p-4"><hr></div>
